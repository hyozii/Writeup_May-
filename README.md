# Dreamhack CTF Season 5 Round #10

ì´ë²ˆì— í’€ Dreamhack wargame ë¬¸ì œëŠ” web ë¶„ì•¼ì˜ pharmacy ë¬¸ì œì´ë‹¤. ì²˜ìŒ writeupê³¼ëŠ” ë‹¬ë¦¬ ì›¹ì„ ì–´ëŠ ì •ë„ ê³µë¶€í–ˆê¸° ë•Œë¬¸ì— ë¬¸ì œë¥¼ ë‹¤ í’€ì§€ëŠ” ëª»í•˜ë”ë¼ë„ ì½”ë“œë¥¼ ë¶„ì„í•˜ê³  ê³µë¶€í•  ìˆ˜ëŠ” ìˆì„ ê²ƒì´ë¼ê³  ìƒê°í•œë‹¤.

ë¬¸ì œë¥¼ ë‹¤ìš´ë°›ì•„ë³´ë‹ˆ ë‹¤ìŒê³¼ ê°™ì€ íŒŒì¼ë“¤ì´ ìˆëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤.

![image](https://github.com/hyozii/Writeup_May-/assets/163365936/a679b99a-facd-49d4-86d4-93593dba76a9)
![image](https://github.com/hyozii/Writeup_May-/assets/163365936/4975e614-c6f0-4e2d-856f-d9c606942922)
![image](https://github.com/hyozii/Writeup_May-/assets/163365936/8197f61b-db16-4984-bdbd-341d894da9be)
![image](https://github.com/hyozii/Writeup_May-/assets/163365936/5172a40e-abc4-4211-8d9a-b53e8c52b3e1)

1. Dockerfile íŒŒì¼

![image](https://github.com/hyozii/Writeup_May-/assets/163365936/dc95769c-567e-4d24-a89e-37b5818e3f53)


ë¨¼ì € Dockerfileì„ ë¨¼ì € ì—´ì–´ë³´ì.Dockerfileì€ dockerì—ì„œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ìš©ë„ë¡œ ì‘ì„±í•˜ëŠ” íŒŒì¼ì´ë‹¤. 
FOMEì€ ìƒì„±í•  ì´ë¯¸ì§€ì˜ ë² ì´ìŠ¤ê°€ ë  ì´ë¯¸ì§€ë¥¼ ì˜ë¯¸í•œë‹¤. ì´ Dockerfileì€ PHP 7.4 ë²„ì „ê³¼ Apache ì›¹ ì„œë²„ê°€ í¬í•¨ëœ ê³µì‹ Docker ì´ë¯¸ì§€ë¥¼ ë² ì´ìŠ¤ë¡œ ì‚¬ìš©í•œë‹¤.

COPYëŠ” <ë³µì‚¬í•  íŒŒì¼ ê²½ë¡œ> <ì´ë¯¸ì§€ì—ì„œ íŒŒì¼ì´ ìœ„ì¹˜í•  ì ˆëŒ€ ê²½ë¡œ> í˜•ì‹ìœ¼ë¡œ ì´ë£¨ì–´ì§€ê³ , ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬í•œë‹¤. RUNì€ ìƒˆë¡œìš´ ë ˆì´ì–´ì—ì„œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•œë‹¤. ë”°ë¼ì„œ COPY ./deploy/run.sh /usr/sbin/ëŠ” run.sh ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì»¨í…Œì´ë„ˆì˜ /usr/sbin/ ë””ë ‰í† ë¦¬ì— ë³µì‚¬í•œë‹¤ëŠ” ëœ»ì´ê³ , RUN chmod +x /usr/sbin/run.sh run.shëŠ” ì´ì— ì‹¤í–‰ ê¶Œí•œì„ ë¶€ì—¬í•œë‹¤ëŠ” ëœ»ì´ë‹¤.
 
 
ë‹¤ìŒìœ¼ë¡œ COPY ./deploy/src /var/www/htmlì™€ RUN chmod 777 /var/www/html/uploadsë„ ë¹„ìŠ·í•˜ê²Œ í•´ì„í•  ìˆ˜ ìˆëŠ”ë°, ./deploy/src ë””ë ‰í† ë¦¬ì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì»¨í…Œì´ë„ˆì˜ /var/www/html ë””ë ‰í† ë¦¬ì— ë³µì‚¬í•˜ê³  /var/www/html/uploads ë””í…í† ë¦¬ì— 777ê¶Œí•œì„ ë¶€ì—¬í•œë‹¤ëŠ” ëœ»ì´ë‹¤. ì´ë•Œ 777ì€ ë¦¬ëˆ…ìŠ¤ ìŠ¤í„°ë”” ë•Œ ë°°ì› ë˜ ê²ƒì²˜ëŸ¼ owner/group/othersì— Read, Write, Access ê¶Œí•œì„ ëª¨ë‘ ë¶€ì—¬í•œë‹¤ëŠ” ëœ»ì´ë‹¤.

COPY ./deploy/flag.txt /ëŠ” ./deploy/flag.txt /íŒŒì¼ì„ ì»¨í…Œì´ë„ˆì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ë³µì‚¬í•œë‹¤ëŠ” ëœ»ì´ë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ EXPOSE 80ì™€ CMD ["/usr/sbin/run.sh"] ì— ëŒ€í•´ ì‚´í´ë³´ìë©´, ì»¨í…Œì´ë„ˆì˜ 80ë²ˆ í¬íŠ¸ë¥¼ ë…¸ì¶œí•˜ê³ , ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ë  ë•Œ []ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•˜ë¼ëŠ” ëœ»ì´ë‹¤.

ê²°êµ­ ì´ Dockerfileì€ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ íŒŒì¼ë¡œ ì–´ë–¤ ì›¹ ì„œë²„ë¥¼ í¬í•¨í•˜ëŠ”ì§€, ì–´ë–¤ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì–´ë–¤ ì»¨í…Œì´ë„ˆì— ë³µì‚¬í•˜ëŠ”ì§€, ì–´ë–¤ í¬íŠ¸ë¥¼ ë…¸ì¶œí•˜ëŠ”ì§€, ì‹¤í–‰ ì‹œì— ì–´ë–¤ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” íŒŒì¼ì´ë‹¤. ë‚´ê°€ ì´ íŒŒì¼ì„ ì˜ ëª¨ë¥´ê¸° ë•Œë¬¸ì¸ì§€, ì•„ë‹ˆë©´ ì •ë§ ë¬¸ì œ í’€ì´ì—ëŠ” ë³„ë¡œ í° ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šê¸° ë•Œë¬¸ì¸ì§€ëŠ” ëª°ë¼ë„ ì§€ê¸ˆ ë‚˜ì—ê²ŒëŠ” ë„ì›€ì´ ë˜ëŠ” ì •ë³´ê°€ ì—†ëŠ” ê²ƒ ê°™ì•˜ë‹¤.

2. flag.txt

![image](https://github.com/hyozii/Writeup_May-/assets/163365936/136ebb43-a35b-4b25-a033-2e39d670eadb)

ë‹¤ìŒìœ¼ë¡œ flag.txtë¥¼ ì—´ì–´ë³´ë‹ˆ placeholderë¼ëŠ” ë‹¨ì–´ê°€ ë“¤ì–´ìˆë‹¤. placeholderëŠ” ì›¹ì„ ê³µë¶€í•  ë•Œ ì…ë ¥ í•„ë“œì— ì‚¬ìš©ìê°€ ì˜¬ë°”ë¥¸ ê°’ì„ ë„£ì„ ìˆ˜ ìˆë„ë¡ íŒíŠ¸ë¥¼ ì¤„ ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒ'ì´ì—ˆë‹¤. ì´ë²ˆ ë¬¸ì œ íŒŒì¼ ì•ˆì— ì´ë¦„ì´ 'placeholder'ì¸ íŒŒì¼ì´ ìˆëŠ”ë°, ê·¸ëŸ¼ ê·¸ íŒŒì¼ì´ íŒíŠ¸ë¼ëŠ” ëœ»ì¼ê¹Œ? flagë¥¼ ì–»ê¸° ìœ„í•´ì„œëŠ” ì € íŒŒì¼ì„ ì´ìš©í•´ì•¼ í•œë‹¤ëŠ” ëœ»ì¼ê¹Œ? ì¼ë‹¨ placeholder íŒŒì¼ì´ ì¤‘ìš”í•˜ë‹¤ëŠ” ì‚¬ì‹¤ì„ í™•ì¸í•˜ê³  ë„˜ì–´ê°€ë³´ì.

3. run.sh

![image](https://github.com/hyozii/Writeup_May-/assets/163365936/238c30d3-f060-4e9f-a788-c8177446160e)

.sh íŒŒì¼ì€ ì£¼ë¡œ ì…¸ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì˜ í™•ì¥ìë¡œ ì‚¬ìš©ë˜ê³ , ì…¸ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì€ ê¸°ë³¸ ëª…ë ¹ì–´ë‚˜ ê°„ë‹¨í•œ ë¬¸ë²•ì„ ì‚¬ìš©í•´ ì‚¬ìš©ìê°€ ì‘ì„±í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì´ë‹¤. ê° ì¤„ì˜ ì½”ë“œë¥¼ í•´ì„í•´ë³´ìë©´,

#!/bin/bashëŠ” ì´ ìŠ¤í¬ë¦½íŠ¸ê°€ bash ì…¸ì—ì„œ ì‹¤í–‰ë˜ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ì•Œë ¤ì¤€ë‹¤. ê·¸ë¦¬ê³  export FLAG="test"ëŠ” export ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•œ ê²ƒì´ë‹¤. ë”°ë¼ì„œ í•´ë‹¹ ì½”ë“œëŠ” FLAG í™˜ê²½ ë³€ìˆ˜ê°€ testë¡œ ì„¤ì •ëœ ê²ƒì´ë‹¤. ë‹¤ë¥¸ ì›Œê²Œì„ ë¬¸ì œë“¤ë„ ì´ëŸ° ì‹ìœ¼ë¡œ í”Œë˜ê·¸ë¥¼ ì°¾ëŠ” ë°©ì‹ì´ë¼ê³  í•˜ëŠ”ë°, flag í™˜ê²½ ë³€ìˆ˜ë¥¼ ì°¾ì•„ë‚´ê³ , ê·¸ ê°’ì´ ì‹¤ì œë¡œ í”Œë˜ê·¸ì¸ì§€ í™•ì¸í•´ì•¼ í•œë‹¤ê³  í•œë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ, &>/dev/null /usr/sbin/apachectl -DFOREGROUND -k startëŠ” Apache ì›¹ ì„œë²„ë¥¼ ì‹¤í–‰í•´ì¤€ë‹¤. ì›¹ ì„œë²„ë¥¼ ì‹¤í–‰í•  ë•Œ í•„ìš”í•œ ì½”ë“œì¸ ê²ƒ ê°™ë‹¤.

ì´ íŒŒì¼ì„ í†µí•´ í”Œë˜ê·¸ë¥¼ ì–»ê¸° ìœ„í•´ì„œëŠ” ì–´ë””ë¥¼ í™•ì¸í•´ë´ì•¼ í•˜ëŠ”ì§€ë¥¼ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.


4. index.php

php íŒŒì¼ì´ë‹ˆ ì €ë²ˆì— ë°°ìš´ëŒ€ë¡œ í™•ì¥ìë¥¼ htmlë¡œ ë°”ê¿”ë³´ì. ê·¸ëŸ¬ë©´ íŒŒì¼ì˜ ì•„ì´ì½˜ì´ í¬ë¡¬ ì•„ì´ì½˜ìœ¼ë¡œ ë°”ë€ë‹¤. ì´ íŒŒì¼ì„ í´ë¦­í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì›¹ ë¸Œë¼ìš°ì €ê°€ ë‚˜ì˜¨ë‹¤.

![image](https://github.com/hyozii/Writeup_May-/assets/163365936/3b1f1aab-4145-4ccc-8701-89de0d62e750)

ì•½êµ­ í…Œë§ˆì˜ ì›¹ ë¸Œë¼ìš°ì €ì¸ë§Œí¼ 'ì•½êµ­, ë‹¹ì‹ ì˜ ì²˜ë°©ì „ì„ gif í˜•ì‹ìœ¼ë¡œ ì—…ë¡œë“œí•˜ì„¸ìš”'ë¼ê³  ì“°ì—¬ìˆë‹¤. í”Œë˜ê·¸ë¥¼ ì–»ê¸° ìœ„í•´ì„œëŠ” ë¬¸ì œ íŒŒì¼ ì¤‘ í•˜ë‚˜ë¥¼ gif í˜•ì‹ìœ¼ë¡œ ë°”ê¿”ì„œ ì € íŒŒì¼ì— ë„£ì–´ì•¼ í•˜ëŠ” ê²ƒ ê°™ë‹¤.

![image](https://github.com/hyozii/Writeup_May-/assets/163365936/7fc8e736-8a7a-4a44-b8e7-1ee4acf9cded)

í˜¹ì‹œ ëª°ë¼ placeholder íŒŒì¼ì„ .gif í˜•ì‹ìœ¼ë¡œ ë°”ê¾¸ê³  ì—…ë¡œë“œí•´ ë³´ì•˜ë‹¤. 

![image](https://github.com/hyozii/Writeup_May-/assets/163365936/6ab2488a-e002-43dd-87cf-d2af1e50a811)

.gif í˜•ì‹ìœ¼ë¡œ ë°”ê¾¸ì§€ ì•Šì•„ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆë‹¤ëŠ” ë©”ì‹œì§€ê°€ ëœ¬ë‹¤. ì´ë ‡ê²Œ ë°”ê¾¸ëŠ” ê±´ ì•ˆë  ê²ƒ ê°™ê³ , htmlì—ì„œ ì½”ë“œë¥¼ ì¶”ê°€í•´ php íŒŒì¼ì„ gif í˜•ì‹ìœ¼ë¡œ ë³€í˜•í•´ì¤˜ì•¼ í•˜ëŠ” ê²ƒ ê°™ë‹¤. ì¼ë‹¨ ë‚´ê°€ ìƒê°í•˜ê¸°ì— ì´ ë¬¸ì œë¥¼ í‘¸ëŠ” ë°©ë²•ì€ ë¬¸ì œ íŒŒì¼ ì¤‘ í•˜ë‚˜ë¥¼ gif íŒŒì¼ë¡œ ë³€í™˜í•´ ì›¹ ë¸Œë¼ìš°ì €ì— ì—…ë¡œë“œí•˜ëŠ” ê²ƒì¸ë°, ì´ ë°©ë²•ì´ ë§ëŠ”ì§€ë„ ëª¨ë¥´ê² ë‹¤....

ì¼ë‹¨ ë§ˆì € ì½”ë“œë¥¼ ë¶„ì„í•´ë³´ì. 

![image](https://github.com/hyozii/Writeup_May-/assets/163365936/7d14c6a6-11b1-479c-a250-94ff25099aff)
![image](https://github.com/hyozii/Writeup_May-/assets/163365936/544948c5-070c-4a1d-9b05-4a7579f8bba1)
![image](https://github.com/hyozii/Writeup_May-/assets/163365936/e86601ac-0ed7-4ecb-821b-61924c31cf34)


ì¼ë‹¨ êµ¬ì¡°ëŠ” <!DOCTYPE html>, <html>, <head>, <body>ë¡œ ì´ë£¨ì–´ì§„ ì „í˜•ì ì¸ html êµ¬ì¡°ì´ë‹¤. <h1>PharmacyğŸ’Š</h1> ì™€ <h2>Upload your prescription in gif format...</h2>ë¡œ ì›¹ í˜ì´ì§€ì— ì œëª© í˜•ì‹ìœ¼ë¡œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆê²Œ í–ˆë‹¤. 

